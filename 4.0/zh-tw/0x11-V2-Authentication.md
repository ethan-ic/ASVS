# V2 認證

## 控制目標

認證是建立或確認某人（或某物）的真實性，並且個人或裝置的宣告是正確的，可防止假冒，並防止恢復或攔截密碼。

當ASVS首次釋出時，使用者名稱+密碼是最常見的認證形式（除高安全系統以外）。 多因素身份驗證（MFA）在安全界被普遍接受，但在其他地方很少需要。 隨著密碼洩露次數的增加，認為使用者名稱在某種程度上是保密的，而密碼則是未知的這種想法使得許多安全控制無法成立。 例如，NIST 800-63 將使用者名稱和基於知識的身份驗證（KBA）視為公共資訊，將 SMS 和電子郵件通知視為[“受限”的認證型別](https://pages.nist.gov/800-63-FAQ/#q-b1)，而密碼是預先洩露的。 這一現實使基於知識的認證器、簡訊和電子郵件恢復、密碼歷史、複雜性和輪換控制變得毫無用處。 這些控制措施不總那麼有用，經常迫使使用者每隔幾個月就想出一些弱的密碼，但是隨著50多億使用者名稱和密碼洩露事件的公佈，現在是時候繼續前進了。

在ASVS的所有章節中，認證和會話管理章節的變化最大。採用有效的、以證據為基礎的領先實踐，對許多人來說將是挑戰，這完全沒問題。 現在我們必須開始向未來的後密碼時代過渡。

## NIST 800-63 - 現代的、基於證據的認證標準

[NIST 800-63b](https://pages.nist.gov/800-63-3/sp800-63b.html) 是一種現代的、基於證據的標準，代表了可用的最佳建議，無論其適用性如何。該標準對世界各地的所有組織都有幫助，但與美國機構和與美國機構打交道的機構尤其相關。

NIST 800-63的術語一開始可能有點令人困惑，特別是你只習慣於使用者名稱+密碼認證的話。 現代認證的進步是必要的，所以我們必須引入將來會變得司空見慣的術語，但我們確實理解：在行業落實這些新術語之前，理解這些新術語的困難。 我們在本章末尾提供了一個詞彙表，以提供幫助。 我們重新表述了許多要求，以滿足要求的意圖，而不只是拘泥於文字。 例如，當NIST在本標準中使用“記憶祕密”時（memorized secret），ASV使用術語“密碼”（password）。

ASVS V2 身份驗證、V3 會話管理以及在較小程度上的V4 訪問控制，已被調整為符合 NIST 800-63b 控制項的一個子集，主要圍繞常見的威脅和經常被利用的認證弱點。如果需要完全遵守NIST 800-63，請參考NIST 800-63。

### 選擇合適的 NIST AAL 級別

應用程式安全驗證標準（ASVS），已嘗試將 ASVS L1 對應到 NIST AAL1 要求，將 L2 對應到 AAL2，將 L3 對應到 AAL3。 然而，ASVS Level 1作為“基本”的控制，不一定是驗證應用或API的正確AAL級別。 例如，如果該應用是 L3 應用或有 AAL3 的監管要求，則應在V2和V3會話管理章節選擇 L3。 應根據NIST 800-63b指南選擇符合NIST標準的認證保證級別（AAL），如[NIST 800-63b第6.2節](https://pages.nist.gov/800-63-3/sp800-63-3.html#AAL_CYOA) 中的 *Selecting AAL* 。

## 圖例

應用程式總是可以超過當前級別的要求，特別是如果現代認證是在應用程式的路線圖上。以前，ASVS要求強制MFA。NIST不要求強制MFA。因此，我們在本章中使用了一個可選的指定，以表明ASVS鼓勵但不要求控制的地方。本標準自始至終使用了以下圖示：

| 標記 | 說明 |
| :--: | :-- |
| | 不要求 |
| o | 建議，但不要求 |
| ✓ | 要求 |

## V2.1 密碼安全

在NIST 800-63中，密碼被稱為“記憶的祕密”（Memorized Secrets），包括密碼、PIN、解鎖圖案、選擇正確的小貓或其他影象元素以及密碼短語。 它們通常被認為是“您知道的東西”，並且通常用作單因素身份認證工具。 繼續使用單因素認證有很大的風險，包括網際網路上披露的數十億有效使用者名稱和密碼、預設或弱密碼、彩虹表和最常見密碼的有序字典。

應用程式應強烈鼓勵使用者註冊多因素認證，並應允許使用者重新使用他們已經擁有的令牌，如FIDO或U2F令牌，或連結到提供多因素認證的憑證服務提供商。

憑據服務提供商（CSP）為使用者提供聯合身份。 使用者通常會擁有多個CSP的多個身份，例如使用Azure AD、Okta、Ping identity或Google的企業身份，或使用Facebook、Twitter、Google或微信的普通使用者，這只是一些常見的可能。 這份清單並不是對這些公司或服務的認可，而只是鼓勵開發者考慮使用者有許多既定身份的現實。 組織應該考慮與現有的使用者身份整合，根據CSP的身份證明強度的風險狀況，組織應考慮與現有使用者身份整合。 例如，政府機構不太可能接受社交媒體身份作為敏感系統的登入名，因為很容易偽造或丟棄身份，而移動遊戲公司可能需要與主要社交媒體平臺整合，以擴大他們的活躍玩家群。

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.1.1** | 驗證使用者設定的密碼長度至少為 12 個字元（多個空格合併後）。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |
| **2.1.2** | 驗證是否允許64個字元以上的密碼，並拒絕超過128個字元的密碼。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |
| **2.1.3** | 驗證不進行密碼截斷。然而，連續的多個空格可以被單個空格代替。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |
| **2.1.4** | 驗證密碼中是否允許使用任何可列印的Unicode字元，包括語言中立字元，例如空格和表情符號。 | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |
| **2.1.5** | 驗證使用者可以更改其密碼。 | ✓ | ✓ | ✓ | 620 | 5.1.1.2 |
| **2.1.6** | 驗證密碼更改功能是否需要使用者的當前密碼和新密碼。 | ✓ | ✓ | ✓ | 620 | 5.1.1.2 |
| **2.1.7** | 驗證在賬戶註冊、登入和密碼更改過程中提交的密碼，是否出現在被洩露過的密碼中，這些密碼可以是本地的（如符合系統密碼策略的前1000個或10000個最常見的密碼），也可以使用外部API。 如果使用API，應使用零知識證明或其他機制，以確保純文字密碼不被髮送或用於驗證密碼的違反狀態。 如果密碼被洩露，應用程式必須要求使用者設定一個新的未被洩露的密碼。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |
| **2.1.8** | 驗證是否提供了密碼強度表，以幫助使用者設定更強的密碼。 | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |
| **2.1.9** | 驗證是否有限制允許的字元型別的密碼組成規則。對大寫或小寫、數字或特殊字元不應有任何要求。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |
| **2.1.10** | 驗證沒有定期更換憑證或密碼歷史的要求。 | ✓ | ✓ | ✓ | 263 | 5.1.1.2 |
| **2.1.11** | 驗證是否允許 “貼上” 功能、瀏覽器密碼輔助工具和外部密碼管理器。 | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |
| **2.1.12** | 驗證使用者可以選擇臨時檢視整個遮蔽的密碼，或者在沒有內建功能的平臺上臨時檢視密碼的最後輸入的字元。 | ✓ | ✓ | ✓ | 521 | 5.1.1.2 |

注意：允許使用者檢視密碼或臨時檢視最後一個字元的目的，是為了提高憑證輸入的可用性，尤其是在使用更長的密碼、口令和密碼管理器時。 包含該要求的另一個原因，是為了防止測試報告不必要地要求組織重寫內建平臺密碼欄位的行為，從而保持這種現代使用者友好的安全體驗。

## V2.2 通用身份驗證器的安全性

身份驗證器的敏捷性，對於面向未來的應用程式至關重要。 重構應用程式驗證器以允許使用者根據偏好新增額外的驗證器，並允許以有序的方式停用已棄用或不安全的驗證器。

NIST 將電子郵件和 SMS 視為 [“受限”的身份驗證器型別](https://pages.nist.gov/800-63-FAQ/#q-b1)，它們很可能在未來的某個時候從NIST 800-63以及ASVS中刪除。 應用程式應計劃一個不需要使用電子郵件或簡訊的路線圖。

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.2.1** | 驗證反自動化控制的措施能夠有效地緩解被洩露的憑證測試、暴力破解和賬戶鎖定攻擊。 這些控制措施包括阻止最常見的洩露密碼、軟鎖定、速率限制、驗證碼、每次嘗試後逐漸增加的間隔時間、IP地址限制，或基於風險的限制，例如位置、裝置上的首次登入、最近解鎖賬戶的嘗試等類似情況。 驗證單個帳戶每小時的失敗嘗試次數不超過 100 次。 | ✓ | ✓ | ✓ | 307 | 5.2.2 / 5.1.1.2 / 5.1.4.2 / 5.1.5.2 |
| **2.2.2** | 驗證弱身份驗證器（例如 SMS 和電子郵件）的使用，僅限於二次驗證和批准交易，而不是作為更安全的認證方法的替代。 驗證是否在弱方法之前提供了更強的方法，使用者是否意識到風險，或者是否採取了適當的措施來限制帳戶洩露的風險。 | ✓ | ✓ | ✓ | 304 | 5.2.10 |
| **2.2.3** | 驗證在更新認證資訊（如憑證重置、電子郵件或地址變更、從未知或風險地點登入）後向使用者傳送安全通知。 最好使用推送通知——而不是簡訊或電子郵件，但在沒有推送通知的情況下，只要通知中沒有披露敏感資訊，簡訊或電子郵件也是可以接受的。 | ✓ | ✓ | ✓ | 620 | |
| **2.2.4** | 驗證對網路釣魚的抗冒充性，如使用多因素認證、有意圖的加密裝置（如有推送認證的連線金鑰），或在更高的AAL級別，客戶端證書。 | | | ✓ | 308 | 5.2.5 |
| **2.2.5** | 驗證當憑證服務提供者（CSP）和驗證認證的應用程式分開時，兩個端點之間有相互認證的TLS（mTLS）。 | | | ✓ | 319 | 5.2.6 |
| **2.2.6** | 驗證抗重放性，是否通過強制使用一次性密碼（OTP）裝置、加密認證器或查詢程式碼。 | | | ✓ | 308 | 5.2.8 |
| **2.2.7** | 通過要求輸入OTP令牌或使用者發起的動作（如按下FIDO硬體鑰匙的按鈕）來驗證認證意圖。 | | | ✓ | 308 | 5.2.9 |

## V2.3 身份驗證器生命週期

認證器是密碼、軟令牌、硬體令牌和生物識別裝置。認證器的生命週期對應用程式的安全至關重要——如果任何人都可以在沒有身份證明的情況下自行註冊一個賬戶，那麼對身份斷言的信任就會很低。 對於像Reddit這樣的社交媒體網站，這是完全可以的。 對於銀行系統來說，更加註重憑證和裝置的註冊和發放（對應用程式的安全至關重要）。

注意：密碼不要有最長的使用壽命，也不要進行密碼輪換。 應檢查密碼是否已洩露，而不是定期更換。

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.3.1** | 驗證系統生成的初始密碼或啟用碼應該是安全隨機生成的，應該至少有6個字元的長度，可以包含字母和數字，並在短時間內過期。這些初始祕密不得被允許成為長期密碼。 | ✓ | ✓ | ✓ | 330 | 5.1.1.2 / A.3 |
| **2.3.2** | 驗證是否支援註冊和使用使用者提供的認證裝置，如U2F或FIDO令牌。 | | ✓ | ✓ | 308 | 6.1.3 |
| **2.3.3** | 驗證更新指令的傳送時間是否足夠，以更新有時間限制的認證器。 | | ✓ | ✓ | 287 | 6.1.4 |

## V2.4 憑證儲存

架構師和開發人員在構建或重構程式碼時，應遵守本節。本節內容只能使用原始碼審查或通過安全單元或整合測試來完全驗證。滲透測試不能識別這裡面的任何問題。

經批准的單向金鑰推導功能列表詳見NIST 800-63 B第5.1.1.2節，以及 [BSI Kryptographische Verfahren: Empfehlungen und Schlussell&auml;ngen (2018)](https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Publikationen/TechnischeRichtlinien/TR02102/BSI-TR-02102.pdf?__blob=publicationFile)。除了上面這些選擇，還可以根據最新的國家或地區選擇演算法和金鑰長度標準。

此部分無法進行滲透測試，因此控制措施未標記為 L1。但是，如果證書被盜，這部分對證書的安全至關重要，因此如果為架構或編碼指南或原始碼審查清單Fork ASVS，請在您的私有版本中將這些控制措施放回 L1。

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.4.1** | 驗證密碼是以一種可以抵抗離線攻擊的形式儲存的。密碼應使用認可的單向金鑰推導或密碼雜湊函式進行加鹽和雜湊。金鑰推導和密碼雜湊函式，在生成密碼雜湊時，將密碼、鹽和計算成本作為輸入。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 916 | 5.1.1.2 |
| **2.4.2** | 驗證鹽的長度至少為32位，並且是任意選擇的，以減少儲存的雜湊值之間的碰撞。對於每個憑證，應儲存唯一的鹽值和由此產生的雜湊值。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 916 | 5.1.1.2 |
| **2.4.3** | 驗證如果使用 PBKDF2，迭代次數應在驗證伺服器效能允許的範圍內，一般至少為100,000次迭代。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 916 | 5.1.1.2 |
| **2.4.4** | 驗證如果使用 bcrypt，工作係數應在驗證伺服器效能允許的範圍內儘量大，最小為10。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | | ✓ | ✓ | 916 | 5.1.1.2 |
| **2.4.5** | 驗證是否執行了金鑰派生函式的額外迭代，使用的是隻有驗證者知道的祕密鹽值。使用經批准的隨機位生成器 [SP 800-90Ar1] 生成鹽值，並至少提供 SP 800-131A 最新修訂版中規定的最低安全強度。祕密鹽值應與雜湊密碼分開儲存（例如，在像硬體安全模組這樣的專用裝置中）。 | | ✓ | ✓ | 916 | 5.1.1.2 |

在提到美國標準時，可以根據需要使用地區或當地標準來代替或補充美國標準。

## V2.5 憑證恢復

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.5.1** | 驗證系統生成的初始啟用或恢復密碼，不會以明文形式傳送給使用者。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 640 | 5.1.1.2 |
| **2.5.2** | 驗證密碼提示或基於知識的身份驗證（所謂的“密碼保護問題”）不存在。 | ✓ | ✓ | ✓ | 640 | 5.1.1.2 |
| **2.5.3** | 驗證密碼憑據恢復不會以任何方式洩露當前密碼。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 640 | 5.1.1.2 |
| **2.5.4** | 驗證共享或預設帳戶不存在（例如“root”、“admin”或“sa”）. | ✓ | ✓ | ✓ | 16 | 5.1.1.2 / A.3 |
| **2.5.5** | 驗證如果更改或替換了身份驗證因素，則使用者會收到此事件的通知。 | ✓ | ✓ | ✓ | 304 | 6.1.2.3 |
| **2.5.6** | 驗證忘記密碼以及其他恢復路徑，使用了安全的恢復機制，例如基於時間的OTP（TOTP）或其他軟令牌、移動推送或其他離線恢復機制。 ([C6](https://owasp.org/www-project-proactive-controls/#div-numbering)) | ✓ | ✓ | ✓ | 640 | 5.1.1.2 |
| **2.5.7** | 驗證如果OTP或多因素身份驗證因素丟失，身份證明的執行水平與註冊時相同。 | | ✓ | ✓ | 308 | 6.1.2.3 |

## V2.6 查詢密碼認證

查詢密碼（譯者注：Look-up secrets，類似於密碼保護卡），是預先生成的祕密程式碼列表，類似於交易授權號碼（TAN）、社交媒體恢復程式碼，或包含一組隨機值的網格。 這些被安全地分配給使用者。這些 查詢程式碼只使用一次，一旦全部使用，查詢的祕密列表就會被丟棄。這種型別的認證器被認為是 “你擁有的東西”。

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.6.1** | 驗證查詢密文只能使用一次。 | | ✓ | ✓ | 308 | 5.1.2.2 |
| **2.6.2** | 驗證查詢祕密有足夠的隨機性（112位熵），如果少於112位熵，則用唯一的隨機32位鹽進行加鹽，並用認可的單向雜湊進行雜湊。 | | ✓ | ✓ | 330 | 5.1.2.2 |
| **2.6.3** | 驗證查詢祕密能夠抵抗離線攻擊，例如可預測的值。 | | ✓ | ✓ | 310 | 5.1.2.2 |

## V2.7 帶外驗證器

在過去，常見的帶外驗證器是包含密碼重置連結的電子郵件或簡訊。攻擊者利用這種薄弱的機制來重置他們尚未控制的賬戶，例如接管一個人的電子郵件賬戶並重新使用任何發現的重置連結。 處理帶外驗證有更好的方法。

安全的帶外驗證器是可以通過安全的二級通道與驗證器進行通訊的物理裝置。 例子包括向移動裝置推送通知。這種型別的驗證器被認為是 “你擁有的東西”。 當用戶希望進行認證時，驗證應用程式通過與認證器的連線，直接或間接地通過第三方服務向帶外認證器傳送一個訊息。 該訊息包含一個認證程式碼（通常是一個隨機的六位數或一個模式化的批准對話方塊）。 驗證應用程式等待通過主通道接收驗證碼，並將接收到的值的雜湊值與原始驗證碼的雜湊值進行比較。如果它們匹配，則帶外驗證器可以認為使用者已通過身份驗證。

ASVS假定只有少數開發者會開發新的帶外認證器，如推送通知，因此以下ASVS控制措施適用於驗證器，如認證API、應用程式和單點登入實現。 如果開發一個新的帶外認證器，請參考 NIST 800-63B &sect; 5.1.3.1。

不安全的帶外認證器，如電子郵件和VOIP是不允許的。 PSTN和SMS認證目前受到NIST的 “限制”，應該被棄用，以支援推送通知或類似的方式。 如果你需要使用電話或簡訊的帶外認證，請參見 NIST 800-63B &sect; 5.1.3.3。

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.7.1** | 驗證預設情況下不提供簡訊或PSTN等帶外的明文認證器，並首先提供推送通知等更強的替代方案。 | ✓ | ✓ | ✓ | 287 | 5.1.3.2 |
| **2.7.2** | 驗證帶外驗證器在10分鐘後將帶外驗證請求、程式碼或令牌過期。 | ✓ | ✓ | ✓ | 287 | 5.1.3.2 |
| **2.7.3** | 驗證帶外驗證器身份驗證請求、程式碼或令牌僅可使用一次，並且僅可用於原始身份驗證請求。 | ✓ | ✓ | ✓ | 287 | 5.1.3.2 |
| **2.7.4** | 驗證帶外驗證器和驗證器是否通過安全的獨立通道進行通訊。 | ✓ | ✓ | ✓ | 523 | 5.1.3.2 |
| **2.7.5** | 驗證帶外驗證器只保留認證程式碼的雜湊版本。 | | ✓ | ✓ | 256 | 5.1.3.2 |
| **2.7.6** | 驗證初始驗證碼是否由安全隨機數生成器生成，包含至少 20 位熵（通常為 6 位數字隨機數即可）。 | | ✓ | ✓ | 310 | 5.1.3.2 |

## V2.8 一次性驗證器

單因素一次性密碼（OTP），是顯示持續變化的偽隨機一次性挑戰的物理或軟令牌。 這些裝置使網路釣魚（冒充）變得困難，但並非不可能。 這種型別的身份驗證器被認為是“你擁有的東西”。 多因素令牌，類似於單因素 OTP，但需要輸入有效的 PIN 碼、生物識別解鎖、USB 插入、NFC 配對或一些附加值（例如交易簽名計算器）才能建立最終 OTP。

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.8.1** | 驗證基於時間的OTP在過期前有確定的使用壽命 | ✓ | ✓ | ✓ | 613 | 5.1.4.2 / 5.1.5.2 |
| **2.8.2** | 驗證用於驗證提交的OTP的對稱金鑰是否被高度保護，例如使用硬體安全模組或基於安全作業系統的金鑰儲存。 | | ✓ | ✓ | 320 | 5.1.4.2 / 5.1.5.2 |
| **2.8.3** | 驗證OTP的生成、播種和驗證是否使用了經過批准的加密演算法。 | | ✓ | ✓ | 326 | 5.1.4.2 / 5.1.5.2 |
| **2.8.4** | 驗證基於時間的OTP在有效期內只能使用一次。 | | ✓ | ✓ | 287 | 5.1.4.2 / 5.1.5.2 |
| **2.8.5** | 驗證如果基於時間的多因素OTP令牌在有效期內被重複使用，將被記錄並拒絕，同時向裝置持有者傳送安全通知。 | | ✓ | ✓ | 287 | 5.1.5.2 |
| **2.8.6** | 驗證物理單因素OTP生成器在被盜或其他損失的情況下可以被撤銷。確保撤銷在登入會話中立即生效，無論在何處。 | | ✓ | ✓ | 613 | 5.2.1 |
| **2.8.7** | 驗證生物特徵身份驗證器僅限於用作次要因素，與“你擁有的東西”和“你知道的東西”一起使用。 | | o | ✓ | 308 | 5.2.3 |

## V2.9 密碼驗證器

加密安全金鑰是智慧卡或FIDO金鑰，使用者必須將加密裝置插入或配對到計算機上才能完成身份驗證。驗證者立即向加密裝置或軟體傳送挑戰隨機數，裝置或軟體根據安全儲存的加密金鑰計算出響應。

對單因素密碼裝置和軟體的要求，和多因素密碼裝置和軟體的要求是一樣的，都是證明密碼認證者擁有認證因素。

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.9.1** | 驗證用於驗證的加密金鑰是否安全儲存並防止洩露，例如使用可信平臺模組（TPM）或硬體安全模組（HSM），或可以使用這種安全儲存的作業系統服務。 | | ✓ | ✓ | 320 | 5.1.7.2 |
| **2.9.2** | 驗證質詢隨機數的長度至少為 64 位，並且在統計學上是唯一的，或在加密裝置的生命週期內是唯一的。 | | ✓ | ✓ | 330 | 5.1.7.2 |
| **2.9.3** | 驗證在生成、播種和驗證中使用經批准的加密演算法。 | | ✓ | ✓ | 327 | 5.1.7.2 |

## V2.10 服務認證

此部分不可滲透測試，因此沒有任何 L1 要求。但是，如果用於架構、編碼或安全程式碼審查，請假設軟體（就像 Java 金鑰庫一樣）是 L1 的最低要求。 在任何情況下都不允許明文儲存祕密。

注：
- HSM，硬體安全模組（Hardware Security Module）
- OS assisted，作業系統協助

| # | 說明 | L1 | L2 | L3 | CWE | [NIST &sect;](https://pages.nist.gov/800-63-3/sp800-63b.html) |
| :---: | :--- | :---: | :---: | :---: | :---: | :---: |
| **2.10.1** | 驗證服務內機密不依賴於不變的憑據，例如密碼、API 金鑰或具有特權訪問許可權的共享帳戶。 | | OS assisted | HSM | 287 | 5.1.1.1 |
| **2.10.2** | 驗證如果服務身份驗證需要密碼，則使用的服務帳戶不是預設憑據（例如，root/root 或 admin/admin 是安裝過程中某些服務的預設設定）。 | | OS assisted | HSM | 255 | 5.1.1.1 |
| **2.10.3** | 驗證儲存的密碼是否有足夠的保護，以防止離線恢復攻擊，包括本地系統訪問。 | | OS assisted | HSM | 522 | 5.1.1.1 |
| **2.10.4** | 驗證密碼、與資料庫和第三方系統的整合、種子和內部機密以及 API 金鑰都得到安全管理，不包含在原始碼中或儲存在原始碼儲存庫中。 這種儲存應能抵禦離線攻擊。建議使用安全的軟體金鑰儲存（L1）、硬體 TPM 或 HSM（L3）來儲存密碼。 | | OS assisted | HSM | 798 | |

## 美國機構的其他要求

美國機構對 NIST 800-63 有強制性要求。 一直以來，應用安全驗證標準都是對幾乎100%的應用採取80%的控制措施，而不是最後20%的高階控制或那些有限的適用性。 因此，ASVS 是 NIST 800-63 的一個嚴格的子集，特別是對於 IAL1/2 和 AAL1/2 分類，但不夠全面，特別是關於 IAL3/AAL3 分類。

我們強烈敦促美國政府機構全面審查和實施 NIST 800-63。

## 術語表

| 術語 | 含義 |
| -- | -- |
| CSP | 憑證服務提供者也稱為身份提供者 |
| Authenticator | 驗證密碼、令牌、MFA、聯合斷言等的程式碼。 |
| Verifier | “通過使用認證協議，驗證申請人對一個或兩個認證器的擁有和控制，來驗證申請人的身份的實體。 為此，驗證者可能還需要驗證將認證器與使用者的識別符號聯絡起來的憑證，並檢查其狀態” |
| OTP | 一次性密碼 |
| SFA | 單因素身份驗證，例如“您知道的東西”（記憶的祕密、密碼、密碼短語、pin），“您的特徵“（生物特徵識別、指紋、面部掃描），或“您擁有的東西“（OTP令牌、智慧卡等加密裝置）， |
| MFA | 多因素認證，包括兩個或多個單因素 |

## 參考文獻

有關更多資訊，請參閱：

* [NIST 800-63 - Digital Identity Guidelines](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63-3.pdf)
* [NIST 800-63 A - Enrollment and Identity Proofing](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63a.pdf)
* [NIST 800-63 B - Authentication and Lifecycle Management](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63b.pdf)
* [NIST 800-63 C - Federation and Assertions](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-63c.pdf)
* [NIST 800-63 FAQ](https://pages.nist.gov/800-63-FAQ/)
* [OWASP Testing Guide 4.0: Testing for Authentication](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/04-Authentication_Testing/README.html)
* [OWASP Cheat Sheet - Password storage](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)
* [OWASP Cheat Sheet - Forgot password](https://cheatsheetseries.owasp.org/cheatsheets/Forgot_Password_Cheat_Sheet.html)
* [OWASP Cheat Sheet - Choosing and using security questions](https://cheatsheetseries.owasp.org/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html)
